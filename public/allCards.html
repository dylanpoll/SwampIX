<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>ROGLE ROGALE</title>
    <meta name="description" content="A rogue-like game with content generated by ML! Including the name!" />
    <meta name="author" content="By Dylan Poll and Lev Vinokur" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,300,400,500,600,800" />
    <link rel="icon" type="image/png" href="./resources/logos/Rogle.png" />
    <link rel="stylesheet" type="text/css" href="./resources/css/newCard.css">
    <!-- jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <!-- Appwrite Web SDK -->
    <script src="https://cdn.jsdelivr.net/npm/appwrite@9.0.1"></script>
</head>

<body>
    <nav class="navbar navbar-dark bg-dark">
        <a class="navbar-brand" href="https://github.com/dylanpoll/SwampIX"><svg height="32" aria-hidden="true"
                viewBox="0 0 16 16" version="1.1" width="32" data-view-component="true"
                class="octicon octicon-mark-github v-align-middle" height="22">
                <path fill-rule="evenodd"
                    d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
                </path>
            </svg> &nbsp;ROGLE Github Repo</a>
        <a class="navbar-brand" href="https://swampix.devdylan.us/"> <img src="./resources/logos/Rogle.png"
                height="32" aria-hidden="true" viewBox="0 0 16 16" version="1.1" width="32">&nbsp; Back To The ROGLE Home Page</a>
    </nav>
    <script>
        // https://swampix.devdylan.us/singleCard.html/?cardCastCost=4&cardName=Ow_the_formidable&cardAttack=5&cardDef=3&cardHealth=8&cardDeathDam=3
        // /resources/cardArt/Ow_the_formidable.png
        $(document).ready(async function () {
            window.cardCastCost = GetURLParameter(Param = "cardCastCost");
            // window.image_path = GetURLParameter(Param="image_path");
            window.cardName = GetURLParameter(Param = "cardName");
            window.cardAttack = GetURLParameter(Param = "cardAttack");
            window.cardDef = GetURLParameter(Param = "cardDef");
            window.cardHealth = GetURLParameter(Param = "cardHealth");
            window.cardDeathDam = GetURLParameter(Param = "cardDeathDam");
            console.log(cardCastCost, cardName, cardAttack, cardDef, cardHealth, cardDeathDam);
            displayPriorGeneratedCards();
            // generateCard(cardCastCost, cardName, cardAttack, cardDef, cardHealth, cardDeathDam);

        });
        function GetURLParameter(Param) {
            var PageURL = window.location.search.substring(1); // /? at the end of a url indicates everything following is a "search" so this gets those items.
            var URLVariables = PageURL.split('&');
            for (var i = 0; i < URLVariables.length; i++) {
                var ParameterName = URLVariables[i].split('=');
                if (ParameterName[0] == Param) {
                    return ParameterName[1];
                }
            }
        }

        async function generateCard(cardCastCost, image_path, cardName, cardAttack, cardDef, cardHealth, cardDeathDam, topSpacing, leftSpacing) {
            const playingCard = document.createElement('div');
            // const playingCard = document.createElement('td');
            // playingCard.setAttribute('type', 'button');
            // playingCard.setAttribute('onclick', 'getUserName()');
            playingCard.setAttribute('style', `background: transparent;margin-top:${topSpacing}px; margin-left:${leftSpacing}px;`);
            playingCard.innerHTML = `
        <div class="cardContainer">
        <div class="cardAvatar" style="background-image:url('`+ image_path + `');"/>
            <div class="cardBase"/>
            <div class="container">
                <table class="cardTextStuff">
                    <tbody>
                        <tr>
                            <td class="cardLevelCost"> ${cardCastCost} </td>
                            <td class="cardName">${cardName}</td>
                            <td class="cardAttckAbsoluteTextPosition"> ${cardAttack} </td>
                            <td class="cardDeffenceAbsoluteTextPosition"> ${cardDef} </td>
                            <td class="cardHealthAbsoluteTextPosition"> ${cardHealth} </td>
                            <td class="cardDeathDamAbsoluteTextPosition"> ${cardDeathDam} </td>
                        </tr>
                    </tbody>
                </table>
                <div class="cardTextStuff"></div>
                <div class="cardDescription"> Descriptions not implemented yet </div>
            </div>
        </div>
`;
            // console.log(playingCard);
            document.body.appendChild(playingCard);
            // document.getElementById("cardTable").appendChild(playingCard);
            // alert(playingCard)
        }



        async function displayPriorGeneratedCards() {
            var myHeaders = new Headers();
            myHeaders.append("X-Appwrite-Project", "63d3a5777ec8d871894e");
            myHeaders.append("X-Appwrite-Response-Format", "1.0.0");

            var requestOptions = {
                method: 'GET',
                headers: myHeaders,
                redirect: 'follow'
            };

            await fetch("https://appwrite.devdylan.us/v1/databases/63d3a613604eb2cde313/collections/63d3a61a70dec437bfaf/documents?queries[0]=limit(100)", requestOptions)
                .then(response => response.json())
                .then(result => {
                    console.log(result)
                    var cardTotal = result.total
                    var displayDivider = 0;
                    var leftIterate = 0;
                    var fiveCounter = 1;
                    for (var cards = 1; cards <= cardTotal; cards++) {
                        try{
                            var topSpacing = displayDivider * 303;
                            var leftSpacing = leftIterate * 223;
                            if (fiveCounter==1) { leftSpacing = 0 };
                            // if (displayDivider == 1) { topSpacing = 0 };
                            var card = result.documents[cards];
                            var cardCastCost = card.castingCost;
                            var cardName = card.cardName;
                            var image_path = card.cardArt;
                            var cardAttack = card.attack;
                            var cardDef = card.defence;
                            var cardHealth = card.health;
                            var cardDeathDam = card.deathDamage;
                            // console.log(cards, cardCastCost, image_path, cardName, cardAttack, cardDef, cardHealth, cardDeathDam, topSpacing, leftSpacing);
                            generateCard(cardCastCost, image_path, cardName, cardAttack, cardDef, cardHealth, cardDeathDam, topSpacing, leftSpacing);
                            if(fiveCounter==5){
                                // console.log("hit counter")
                                displayDivider = displayDivider + 1;
                                leftIterate = 0;
                                fiveCounter = 1;
                            }
                            else{
                                // console.log("incrimented");
                                leftIterate = leftIterate + 1;
                                fiveCounter = fiveCounter + 1;
                            }
                            }catch{
                                console.log("failed to get card " + cardName)
                            }
                    }
                    // alert("Current cards stored in DB = " + cardTotal + " | Currently all cards can be viewed by using the https://appwrite.devdylan.us/v1/databases/63d3a613604eb2cde313/collections/63d3a61a70dec437bfaf/documents api endpoint with a get request, however rendering them is proving to be a bit tricky. open dev tools in browser to see the json bodies for the 5 rendered currently!");
                    // return response
                })
                .catch(error => console.log('error', error));
        }

    </script>

</body>

</html>